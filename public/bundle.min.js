!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){var params=require("./CostAlgorithmParameters.js"),helpers=require("./CostAlgorithmHelpers.js"),costAlgorithmRouter=function(n1,n2,f1,f2,costDatabase){var key=n1.toString()+","+n2.toString()+","+f1.toString()+","+f2.toString(),noteD=Math.abs(n2-n1),fingD=helpers.fingerDistance(f1,f2);if(Math.abs(n2-n1)>0&&0===f2-f1)costDatabase[key]=helpers.ascMoveFormula(noteD,fingD,n1,n2);else if(n2-n1>=0&&0>f2-f1&&1!==f2)costDatabase[key]=helpers.ascMoveFormula(noteD,fingD,n1,n2,f1,f2);else if(0>n2-n1&&f2-f1>0&&1!==f1)costDatabase[key]=helpers.ascMoveFormula(noteD,fingD,n1,n2,f1,f2);else if(n2-n1>=0&&0>f2-f1&&1===f2)costDatabase[key]=helpers.ascThumbCost(noteD,fingD,n1,n2,f1,f2);else if(0>n2-n1&&1===f1&&1!==f2)costDatabase[key]=helpers.descThumbCost(noteD,fingD,n1,n2,f1,f2);else{var stretch=helpers.fingerStretch(f1,f2),x=Math.abs(noteD-fingD)/stretch;costDatabase[key]=x>params.moveCutoff?helpers.descMoveFormula(noteD,fingD,n1,n2,f1,f2):helpers.ascDescNoCrossCost(noteD,fingD,x,n1,n2,f1,f2)}};module.exports.createCostDatabase=function(){for(var RHcostDatabase={},finger1=1;5>=finger1;finger1++)for(var note1=21;109>note1;note1++)for(var finger2=1;5>=finger2;finger2++)for(var note2=21;109>note2;note2++)costAlgorithmRouter(note1,note2,finger1,finger2,RHcostDatabase);return RHcostDatabase}},{"./CostAlgorithmHelpers.js":2,"./CostAlgorithmParameters.js":3}],2:[function(require,module){var params=require("./CostAlgorithmParameters.js"),mod=module.exports,ThumbCrossCostFunc=function(x){return.0002185873295*Math.pow(x,7)-.008611946279*Math.pow(x,6)+.1323250066*Math.pow(x,5)-1.002729677*Math.pow(x,4)+3.884106308*Math.pow(x,3)-6.723075747*Math.pow(x,2)+1.581196785*x+7.711241722},colorRules=function(n1,n2,f1,f2,fingD){if("White"===params.color[n1%12]&&"Black"===params.color[n2%12]){if(5===f2||1===f2)return 4;if(0===fingD)return 4}if("Black"===params.color[n1%12]&&"White"===params.color[n2%12]){if(5===f1||1===f1)return 4;if(0===fingD)return-1}return 0},ascMoveFormula=mod.ascMoveFormula=function(noteD,fingD,n1,n2,f1,f2){var cost,totalD=Math.ceil(noteD+fingD);return totalD>24?params.moveHash[24]+(totalD-24)/5:(cost=params.moveHash[totalD],cost+=colorRules(n1,n2,f1,f2,fingD))};mod.descMoveFormula=function(noteD,fingD,n1,n2,f1,f2){var cost,totalD=Math.ceil(noteD-fingD);return totalD>24?params.moveHash[24]+(totalD-24)/5:(cost=params.moveHash[totalD],cost+=colorRules(n1,n2,f1,f2,fingD))},mod.fingerDistance=function(f1,f2){var key=f1.toString()+","+f2.toString();return params.fingDistance[key]},mod.ascThumbCost=function(noteD,fingD,n1,n2,f1,f2){var stretch=ascThumbStretch(f1,f2),x=(noteD+fingD)/stretch;if(x>10)return ascMoveFormula(noteD,fingD);var cost=ThumbCrossCostFunc(x);return"White"===params.color[n1%12]&&"Black"===params.color[n2%12]&&(cost+=8),cost},mod.descThumbCost=function(noteD,fingD,n1,n2,f1,f2){var stretch=descThumbStretch(f1,f2),x=(noteD+fingD)/stretch;if(x>10)return ascMoveFormula(noteD,fingD);var cost=ThumbCrossCostFunc(x);return"Black"===params.color[n1%12]&&"White"===params.color[n2%12]&&(cost+=8),cost};var descThumbStretch=mod.descThumbStretch=function(f1,f2){var key=f1.toString()+","+f2.toString();return params.descThumbStretchVals[key]},ascThumbStretch=mod.ascThumbStretch=function(f1,f2){var key=f1.toString()+","+f2.toString();return params.ascThumbStretchVals[key]};mod.fingerStretch=function(f1,f2){var key=f1.toString()+","+f2.toString();return params.fingStretch[key]},mod.ascDescNoCrossCost=function(noteD,fingD,x,n1,n2,f1,f2){var cost,costFunc=function(x){return-6.589793725e-7*Math.pow(x,10)-2336381414e-15*Math.pow(x,9)+9925769823e-14*Math.pow(x,8)+.0001763353131*Math.pow(x,7)-.004660305277*Math.pow(x,6)-.004290746384*Math.pow(x,5)+.06855725903*Math.pow(x,4)+.03719817227*Math.pow(x,3)+.4554696705*Math.pow(x,2)-.08305450359*x+.3020594956};return x>6.8&&x<=params.moveCutoff?costFunc(6.8)+3*(x-6.8):(cost=costFunc(x),cost+=colorRules(n1,n2,f1,f2))}},{"./CostAlgorithmParameters.js":3}],3:[function(require,module){var mod=module.exports;mod.moveCutoff=7.5,mod.color={0:"White",1:"Black",2:"White",3:"Black",4:"White",5:"White",6:"Black",7:"White",8:"Black",9:"White",10:"Black",11:"White"},mod.fingDistance={"1,1":0,"1,2":2,"1,3":3.5,"1,4":5,"1,5":7,"2,1":2,"2,2":0,"2,3":2,"2,4":3.5,"2,5":5,"3,1":3.5,"3,2":2,"3,3":0,"3,4":2,"3,5":3.5,"4,1":5,"4,2":3.5,"4,3":2,"4,4":0,"4,5":2,"5,1":7,"5,2":5,"5,3":3.5,"5,4":2,"5,5":0};var makeMoveHash=mod.makeMoveHash=function(fixedCost){var moveHash={1:0,2:.5,3:1.8,4:3,5:5,6:7,7:8,8:8.9,9:9.7,10:10.5,11:11,12:11.4,13:11.8,14:12.2,15:12.5,16:12.8,17:13.1,18:13.4,19:13.7,20:14,21:14.3,22:14.6,23:14.9,24:15.2};for(var each in moveHash)moveHash[each]+=fixedCost;return moveHash};mod.moveHash=makeMoveHash(4),mod.descThumbStretchVals={"1,2":1,"1,3":1,"1,4":.9,"1,5":.95},mod.ascThumbStretchVals={"2,1":.95,"3,1":1,"4,1":.95,"5,1":.95},mod.fingStretch={"1,1":.8,"1,2":1.15,"1,3":1.4,"1,4":1.45,"1,5":1.6,"2,1":1.15,"2,2":.6,"2,3":.9,"2,4":1.15,"2,5":1.3,"3,1":1.4,"3,2":.9,"3,3":.6,"3,4":.9,"3,5":1.15,"4,1":1.45,"4,2":1.15,"4,3":.9,"4,4":.7,"4,5":.7,"5,1":1.6,"5,2":1.3,"5,3":1.15,"5,4":.8,"5,5":.6}},{}],4:[function(require,module){var helpers=require("./FingeringAlgorithmHelpers.js");module.exports.FingeringAlgorithm=function(midiData){for(var dataWithStarts=helpers.addStartTimes(midiData),i=0;i<app.preComputed.length;i++)if(app.preComputed[i].title===app.currentSong){var bestPath=app.preComputed[i].BestPathObj;return helpers.distributePath(bestPath,dataWithStarts),void 0}for(var noteTrellis=helpers.makeNoteTrellis(dataWithStarts),layer=1;layer<noteTrellis.length;layer++)for(var node1=0;node1<noteTrellis[layer].length;node1++)for(var min=1/0,node2=0;node2<noteTrellis[layer-1].length;node2++){var curNode=noteTrellis[layer][node1],prevNode=noteTrellis[layer-1][node2],totalCost=prevNode.nodeScore||0,curData=helpers.getSplitData(curNode),prevData=helpers.getSplitData(prevNode),curRH=curData.right,prevRH=prevData.right;if(curRH.notes.length>0)for(var counter=2,tempPrevNode=prevNode;0===prevRH.notes.length;){var bestPrevious=tempPrevNode.bestPrev,prevBestNode=noteTrellis[layer-counter][bestPrevious];prevRH=helpers.getSplitData(prevBestNode).right,counter++,tempPrevNode=prevBestNode}var curLH=curData.left,prevLH=prevData.left;if(curLH.notes.length>0)for(var counter=2,tempPrevNode=prevNode;0===prevLH.notes.length;){var bestPrevious=tempPrevNode.bestPrev,prevBestNode=noteTrellis[layer-counter][bestPrevious];prevLH=helpers.getSplitData(prevBestNode).left,counter++,tempPrevNode=prevBestNode}var RHCost=helpers.calcCost(curRH,prevRH,curLH,"RH"),LHCost=helpers.calcCost(curLH,prevLH,curRH,"LH");totalCost+=RHCost+LHCost,min>totalCost&&(min=totalCost,curNode.nodeScore=totalCost,curNode.bestPrev=node2)}for(var currentNode=helpers.findMin(noteTrellis[noteTrellis.length-1]),bestPathObj={},j=noteTrellis.length-1;j>0;j--){for(var nodeObj=noteTrellis[j][currentNode],fingers=nodeObj.fingers,notes=nodeObj.notes,k=0;k<notes.length;k++){var note=notes[k][0],startTime=notes[k][1],finger=fingers[k],key=note+","+startTime;bestPathObj[key]=finger}currentNode=nodeObj.bestPrev}helpers.distributePath(bestPathObj,dataWithStarts)}},{"./FingeringAlgorithmHelpers.js":5}],5:[function(require,module){var RHcostDb=require("./CostAlgorithm.js").createCostDatabase(),LHcostDb=require("./LHCostAlgorithm.js").createLHCostDatabase(),mod=module.exports;mod.notes={0:"C",1:"C#",2:"D",3:"Eb",4:"E",5:"F",6:"F#",7:"G",8:"G#",9:"A",10:"Bb",11:"B"};for(var getAllFingerOptions=function(numFingers){var results=[],fingOptions=[-5,-4,-3,-2,-1,1,2,3,4,5],walker=function(numFingers,currentFingers,fingerOptions){if(currentFingers.length===numFingers)return results.push(currentFingers.slice()),void 0;for(var i=0;i<fingerOptions.length;i++){currentFingers.push(fingerOptions[i]);var current=currentFingers,temp=fingerOptions.slice();temp.splice(0,i+1),walker(numFingers,current,temp),currentFingers.pop()}};return walker(numFingers,[],fingOptions),results},allFingerOptions={},i=1;10>=i;i++)allFingerOptions[i]=getAllFingerOptions(i);var endCap=[{notes:["e","e"],fingers:[1,-1]}],makeNoteNode=function(notes,fingers){this.notes=notes,this.fingers=fingers,this.nodeScore=0,this.bestPrev=void 0},makeLayer=function(notes){for(var sortedNotes=notes.sort(function(a,b){return a[0]-b[0]}),layer=[],options=allFingerOptions[sortedNotes.length],i=0;i<options.length;i++){var fingerChoice=options[i],node=new makeNoteNode(sortedNotes,fingerChoice);layer.push(node)}return layer},findNoteHolder=function(curPlaying,note){for(var i=0;i<curPlaying.length;i++)if(curPlaying[i][0]===note)return i};mod.makeNoteTrellis=function(midiData){var curPlaying=[],lastWasOn=!1,trellis=[];trellis.push(endCap);for(var pair=0;pair<midiData.length;pair++){var newLayer,notePlace,eventData=midiData[pair][0].event,note=eventData.noteNumber;if("noteOn"===eventData.subtype){var startTime=eventData.startTime;curPlaying.push([note,startTime]),lastWasOn=!0}"noteOff"===eventData.subtype&&(lastWasOn?(newLayer=makeLayer(curPlaying.slice()),trellis.push(newLayer),notePlace=findNoteHolder(curPlaying,note),curPlaying.splice(notePlace,1),lastWasOn=!1):(notePlace=findNoteHolder(curPlaying,note),curPlaying.splice(notePlace,1),lastWasOn=!1))}return trellis};var computeRHCost=function(n1,n2,f1,f2){if("e"===n1||"e"===n2)return 0;var key=n1+","+n2+","+f1+","+f2,cost=RHcostDb[key],distBelowC=60-n2;return cost+=distBelowC>0?distBelowC:0},computeLHCost=function(n1,n2,f1,f2){if("e"===n1||"e"===n2)return 0;f1=Math.abs(f1),f2=Math.abs(f2);var key=n1+","+n2+","+f1+","+f2,cost=LHcostDb[key],distAboveC=n2-60;return cost+=distAboveC>0?distAboveC:0};mod.findMin=function(layer){for(var minNode,minScore=1/0,node=0;node<layer.length;node++)layer[node].nodeScore<minScore&&(minScore=layer[node].nodeScore,minNode=node);return minNode},mod.distributePath=function(bestPathObj,midiData){var nowPlaying={};for(var each in bestPathObj)bestPathObj[each]=+bestPathObj[each];for(var pair=0;pair<midiData.length;pair++){var eventData=midiData[pair][0].event,note=eventData.noteNumber;if("noteOn"===eventData.subtype){var startTime=eventData.startTime,key=note+","+startTime,finger=bestPathObj[key];eventData.finger=finger,nowPlaying[note]=finger}"noteOff"===eventData.subtype&&(eventData.finger=nowPlaying[note])}},mod.addStartTimes=function(midiData){for(var curStartTime=0,pair=0;pair<midiData.length;pair++){var eventData=midiData[pair][0].event;"noteOff"===eventData.subtype?curStartTime+=eventData.deltaTime:"noteOn"===eventData.subtype&&(eventData.startTime=curStartTime,curStartTime+=eventData.deltaTime)}return midiData},mod.getSplitData=function(node){for(var result={right:{notes:[],fingers:[]},left:{notes:[],fingers:[]}},i=0;i<node.fingers.length;i++)node.fingers[i]>0?(result.right.fingers.push(node.fingers[i]),result.right.notes.push(node.notes[i])):(result.left.fingers.push(node.fingers[i]),result.left.notes.push(node.notes[i]));return result},mod.calcCost=function(curNode,prevNode,otherHandCurNode,whichHand){for(var costFunction="RH"===whichHand?computeRHCost:computeLHCost,totalCost=0,i=0;i<curNode.notes.length;i++){var curNote=curNode.notes[i][0],curFinger=curNode.fingers[i],hasNextNote=curNode.notes[i+1]||!1,nextFinger=curNode.fingers[i+1];totalCost+=hasNextNote?costFunction(curNote,hasNextNote[0],curFinger,nextFinger):"RH"===whichHand?60-curNote:curNote-60;for(var j=0;j<prevNode.notes.length;j++){var prevNote=prevNode.notes[j][0],prevFinger=prevNode.fingers[j],transCost=costFunction(prevNote,curNote,prevFinger,curFinger);totalCost+=transCost}}return totalCost}},{"./CostAlgorithm.js":1,"./LHCostAlgorithm.js":6}],6:[function(require,module){var params=require("./CostAlgorithmParameters.js"),helpers=require("./CostAlgorithmHelpers.js"),LHcostAlgorithmRouter=function(n1,n2,f1,f2,costDatabase){var key=n1.toString()+","+n2.toString()+","+f1.toString()+","+f2.toString(),noteD=Math.abs(n2-n1),fingD=helpers.fingerDistance(f1,f2);if(noteD>0&&0===f2-f1)costDatabase[key]=helpers.ascMoveFormula(noteD,fingD,n1,n2);else if(0>=n2-n1&&0>f2-f1&&1!==f2)costDatabase[key]=helpers.ascMoveFormula(noteD,fingD);else if(n2-n1>0&&f2-f1>0&&1!==f1)costDatabase[key]=helpers.ascMoveFormula(noteD,fingD);else if(0>=n2-n1&&0>f2-f1&&1===f2)costDatabase[key]=helpers.ascThumbCost(noteD,fingD,n1,n2,f1,f2);else if(n2-n1>=0&&1===f1&&1!==f2)costDatabase[key]=helpers.descThumbCost(noteD,fingD,n1,n2,f1,f2);else{var stretch=helpers.fingerStretch(f1,f2),x=Math.abs(noteD-fingD)/stretch;costDatabase[key]=x>params.moveCutoff?helpers.descMoveFormula(noteD,fingD):helpers.ascDescNoCrossCost(noteD,fingD,x,n1,n2,f1,f2)}};module.exports.createLHCostDatabase=function(){for(var LHcostDatabase={},finger1=1;5>=finger1;finger1++)for(var note1=21;109>note1;note1++)for(var finger2=1;5>=finger2;finger2++)for(var note2=21;109>note2;note2++)LHcostAlgorithmRouter(note1,note2,finger1,finger2,LHcostDatabase);return LHcostDatabase}},{"./CostAlgorithmHelpers.js":2,"./CostAlgorithmParameters.js":3}],7:[function(require,module){var KeyboardDesign=require("./Visuals/Piano/KeyboardDesign.js").KeyboardDesign,Keyboard=require("./Visuals/Piano/Keyboard.js").Keyboard,RightHand=require("./Visuals/Hands/Right/RightHand.js").RightHand,LeftHand=require("./Visuals/Hands/Left/LeftHand.js").LeftHand,Scene=require("./Visuals/Scene.js").Scene;require("./Algorithms/CostAlgorithm").createCostDatabase;var fingeringAlgo=require("./Algorithms/FingeringAlgorithm.js").FingeringAlgorithm,PlayControls=require("./PlayControls.js").PlayControls;module.exports.App=function(){this.keyboardDesign=new KeyboardDesign,this.keyboard=new Keyboard(this.keyboardDesign),this.rightHand=new RightHand(this.keyboard),this.leftHand=new LeftHand(this.keyboard),this.player=MIDI.Player;var _this=this;this.player.addListener(function(data){var rightHand=_this.rightHand,leftHand=_this.leftHand,NOTE_ON=144,NOTE_OFF=128,note=data.note,message=data.message,finger=data.finger;message===NOTE_ON?(_this.keyboard.press(note),finger>0?rightHand.press(finger,note):leftHand.press(finger,note)):message===NOTE_OFF&&(_this.keyboard.release(note),finger>0?rightHand.release(finger):leftHand.release(finger))}),this.player.setAnimation({delay:20,callback:function(data){var current=data.now,total=data.end;_this.playControls.displayProgress(current,total)}}),this.loadMidiFile=function(midiFile,newStartPercent){var _this=this;this.player.loadFile(midiFile,function(){_this.playControls.setCurrentTIme(newStartPercent)})},this.upload=function(file){var _this=this,reader=new FileReader;reader.onload=function(e){var midiFile=e.target.result;_this.loadMidiFile(midiFile)},reader.readAsDataURL(file)},this.initScene=function(){var _this=this;this.scene=new Scene("#canvas"),this.scene.add(this.keyboard.model),this.scene.add(this.rightHand.model),this.scene.add(this.leftHand.model),this.scene.animate(function(){_this.keyboard.update(),_this.rightHand.update(),_this.leftHand.update(),TWEEN.update()})},this.initMIDI=function(callback){MIDI.loadPlugin(function(){MIDI.channels[9].mute=!0}),"function"==typeof callback&&callback()},this.initPlayControls=function(container,app){_this.playControls=new PlayControls(container,app)},this.fingeringAlgorithm=function(){fingeringAlgo(_this.player.data)}}},{"./Algorithms/CostAlgorithm":1,"./Algorithms/FingeringAlgorithm.js":4,"./PlayControls.js":9,"./Visuals/Hands/Left/LeftHand.js":14,"./Visuals/Hands/Right/RightHand.js":20,"./Visuals/Piano/Keyboard.js":26,"./Visuals/Piano/KeyboardDesign.js":27,"./Visuals/Scene.js":29}],8:[function(require){var App=require("./App.js").App;$(document).on("ready",function(){var app=window.app=new App;$.ajax({url:"/getAllPaths",success:function(data){var allPaths=JSON.parse(data);app.preComputed=allPaths}}),app.initMIDI(),app.initPlayControls($(".main-container"),app),app.initScene(),setTimeout(function(){$($(".player-songList > li")[0]).trigger("click")},2e3)})},{"./App.js":7}],9:[function(require,module){module.exports.PlayControls=function(container,app){$(container),$(".player-songListContainer",this.$container),$(".player-controls",this.$container);var $progressContainer=$(".player-progress-container",this.$container),$progressBar=$(".player-progress-bar",this.$container);$(".player-progress-text",this.$container);var $songList=$(".player-songList",this.$container);$(".song",this.$container);var $tempoChanger=$(".tempo-changer",this.$container),$playBtn=$(".player-playBtn",this.$container),$pauseBtn=$(".player-pauseBtn",this.$container),$currentSong=$(".current-song"),_this=this;$playBtn.click(function(){_this.playing===!1?_this.resume():_this.play()}),$pauseBtn.click(function(){_this.pause()}),$songList.on("click",function(event){var $target=$(event.target),trackName=$target.text();$currentSong.text(trackName),_this.playing=!1,app.currentSong=trackName,$.ajax({url:"/songs/"+trackName,dataType:"text",success:function(data){app.loadMidiFile(data,0)}})}),$progressContainer.click(function(event){var progressPercent=(event.clientX-$progressContainer.offset().left)/$progressContainer.width();console.log(progressPercent),_this.setCurrentTIme(progressPercent)}),$tempoChanger.click(function(event){var $target=$(event.target),timeWarp=$target.find("input").attr("data-timeWarp");console.log(timeWarp),app.player.timeWarp=timeWarp;var trackName=app.currentSong;$.ajax({url:"/songs/"+trackName,dataType:"text",success:function(data){var currentProgress=$progressBar.width()/$progressContainer.width();app.loadMidiFile(data,currentProgress)}})}),this.play=function(){$playBtn.hide(),$pauseBtn.show(),_this.playing=!0,app.player.resume()},this.resume=function(){$playBtn.hide(),$pauseBtn.show(),app.player.currentTime+=1e-6,_this.playing=!0,app.player.resume()},this.stop=function(){app.player.stop(),_this.playing=!1},this.pause=function(){_this.playing=!1,$playBtn.show(),$pauseBtn.hide(),app.player.pause(),_this.resume()},this.getEndTime=function(){return app.player.endTime},this.displayProgress=function(current,total){var percent=current/total,newWidth=Math.floor(percent*$progressContainer.width());$progressBar.width(newWidth)},this.setCurrentTIme=function(progressPercent){var currentTime=app.player.endTime*progressPercent;app.player.currentTime=currentTime,setTimeout(_this.resume,10),app.player.pause()}}},{}],10:[function(require,module){module.exports.Dummy=function(){var Geometry=new THREE.CubeGeometry(1,1,1),Material=new THREE.MeshLambertMaterial({color:0}),Position=new THREE.Vector3(0,0,0);this.model=new THREE.Mesh(Geometry,Material),this.model.position.copy(Position),this.model.visible=!1}},{}],11:[function(require,module){var params=require("./FingerMoveParams.js").params;module.exports.Finger=function(Keyboard){var pressAmount=.6;this.originalY=.2,this.pressedY=this.originalY-pressAmount,this.releaseSpeed=.05,this.moveSpeed=.1;var keyboard=Keyboard;this.distances=params(keyboard),this.press=function(note){this.moveToNote(note),this.model.position.y=this.pressedY,this.isPressed=!0},this.release=function(){this.isPressed=!1},this.moveToNote=function(noteNum){this.currentPos.x=this.model.position.x,this.currentPos.y=this.model.position.y,this.currentPos.z=this.model.position.z;var aboveNeighbor=this.model.parent.children[this.number+1].currentNote,belowNeighbor=this.model.parent.children[this.number-1].currentNote;noteNum>this.model.currentNote?this.model.currentNote=aboveNeighbor===noteNum?noteNum-1:noteNum:noteNum<this.model.currentNote&&(this.model.currentNote=belowNeighbor===noteNum?noteNum+1:noteNum),this.setNewPos(this.model.currentNote),this.setUpNewTween()},this.update=function(){if(this.model.position.y<this.originalY&&this.isPressed===!1){var offset=this.originalY-this.model.position.y;this.model.position.y+=Math.min(offset,this.releaseSpeed)}},this.currentPos={x:0,y:0,z:0},this.newPos={x:0,y:0,z:0},this.setNewPos=function(noteNum){this.newPos.x=keyboard.model.children[noteNum-21].position.x,this.newPos.y=keyboard.keys[noteNum].model.position.y+this.originalY,this.newPos.z=keyboard.keys[noteNum].model.position.z+.5},this.setUpNewTween=function(){var _this=this,update=function(){_this.model.position.x=_this.currentPos.x,_this.model.position.y=_this.currentPos.y+.1,_this.model.position.z=_this.currentPos.z},easing=TWEEN.Easing.Quadratic.Out,tween=new TWEEN.Tween(this.currentPos).to(this.newPos,150).easing(easing).onUpdate(update);tween.start()},this.setUpPressReleaseTween=function(){}}},{"./FingerMoveParams.js":12}],12:[function(require,module){module.exports.params=function(keyboard){var distances={};return distances.get=function(note1,note2){return keyboard.model.children[note2-21].position.x-keyboard.model.children[note1-21].position.x},distances},module.exports.distances=function(){}},{}],13:[function(require,module){module.exports.HandDesign=function(keyboard){this.pinkyWidth=.14,this.pinkyHeight=.1,this.pinkyLength=.57,this.pinkyColor=16711680,this.ringFingerWidth=.18,this.ringFingerHeight=.1,this.ringFingerLength=.61,this.ringFingerColor=26112,this.middleFingerWidth=.185,this.middleFingerHeight=.1,this.middleFingerLength=.7,this.middleFingerColor=13311,this.indexFingerWidth=.188,this.indexFingerHeight=.1,this.indexFingerLength=.6,this.indexFingerColor=16776960,this.thumbWidth=.175,this.thumbHeight=.1,this.thumbLength=.5,this.thumbColor=16724991,this.keyboard=keyboard,this.keyboardHeight=.22}},{}],14:[function(require,module){var LeftPinky=require("./LeftPinky.js").LeftPinky,LeftRing=require("./LeftRing.js").LeftRing,LeftMiddle=require("./LeftMiddle.js").LeftMiddle,LeftIndex=require("./LeftIndex.js").LeftIndex,LeftThumb=require("./LeftThumb.js").LeftThumb,HandDesign=require("../HandDesign.js").HandDesign,Dummy=require("../Dummy.js").Dummy;module.exports.LeftHand=function(keyboard){var _this=this,handDesign=new HandDesign(keyboard),pinky=new LeftPinky(handDesign,"left"),ring=new LeftRing(handDesign,"left"),middle=new LeftMiddle(handDesign,"left"),index=new LeftIndex(handDesign,"left"),thumb=new LeftThumb(handDesign,"left"),dummy1=new Dummy,dummy2=new Dummy;this.fingers=[],this.model=new THREE.Object3D,this.fingers.push(void 0),this.model.add(dummy1.model),dummy1.model.currentNote=-1,this.model.add(thumb.model),this.fingers.push(thumb),thumb.model.currentNote=1,this.model.add(index.model),this.fingers.push(index),index.model.currentNote=1,this.model.add(middle.model),this.fingers.push(middle),middle.model.currentNote=1,this.model.add(ring.model),this.fingers.push(ring),ring.model.currentNote=1,this.model.add(pinky.model),this.fingers.push(pinky),pinky.model.currentNote=1,this.model.add(dummy2.model),dummy2.model.currentNote=110,thumb.moveToNote(55),index.moveToNote(53),middle.moveToNote(52),ring.moveToNote(50),pinky.moveToNote(48),this.model.position.y-=.11,this.model.traverse(function(object){object.position.x-=4.45}),this.offSet=.2222,this.press=function(finger,noteNum){finger=Math.abs(finger);for(var newPosition=keyboard.keys[noteNum].model.position.x,i=1;5>=i;i++)i===finger?_this.fingers[i].press(noteNum):_this.fingers[i].moveAsNeeded(finger,newPosition,noteNum)},this.release=function(finger){finger=Math.abs(finger),_this.fingers[finger].release()},this.update=function(){for(var fingers=_this.fingers,i=1;i<fingers.length;i++)fingers[i].update()}}},{"../Dummy.js":10,"../HandDesign.js":13,"./LeftIndex.js":15,"./LeftMiddle.js":16,"./LeftPinky.js":17,"./LeftRing.js":18,"./LeftThumb.js":19}],15:[function(require,module){var Finger=require("../Finger.js").Finger,LeftIndex=module.exports.LeftIndex=function(handInfo){Finger.call(this,handInfo.keyboard);var indexFingerGeometry=new THREE.CubeGeometry(handInfo.indexFingerWidth,handInfo.indexFingerHeight,handInfo.indexFingerLength),indexFingerMaterial=new THREE.MeshLambertMaterial({color:handInfo.indexFingerColor}),indexFingerPosition=new THREE.Vector3(0,.2,.4);this.model=new THREE.Mesh(indexFingerGeometry,indexFingerMaterial),this.model.position.copy(indexFingerPosition),this.originalY=indexFingerPosition.y,this.number=2;var dist=this.distances;this.moveAsNeeded=function(finger,newPosition,newNote){var curX=this.currentPos.x,delta=newPosition-curX,curNote=this.model.currentNote;switch(finger){case 5:this.pinkyRules(delta,curX,curNote,newNote);break;case 4:this.ringRules(delta,curX,curNote,newNote);break;case 3:this.middleRules(delta,curX,curNote,newNote);break;case 1:this.thumbRules(delta,curX,curNote,newNote)}},this.pinkyRules=function(delta,curX,curNote,newNote){delta>=dist.get(curNote,curNote-8)&&delta<=dist.get(curNote,curNote-4)||this.moveToNote(newNote+5)},this.ringRules=function(delta,curX,curNote,newNote){delta>=dist.get(curNote,curNote-6)&&delta<=dist.get(curNote,curNote-4)||this.moveToNote(newNote+3)},this.middleRules=function(delta,curX,curNote,newNote){delta>=dist.get(curNote,curNote-5)&&delta<=dist.get(curNote,curNote-1)||this.moveToNote(newNote+4)},this.thumbRules=function(delta,curX,curNote,newNote){if(!(delta>0&&delta<=dist.get(curNote,curNote+4)))if(delta>dist.get(curNote,curNote-3)&&0>delta){var _this=this;setTimeout(_this.moveToNote(newNote-2),100)}else this.moveToNote(newNote-2)}};LeftIndex.prototype=Object.create(Finger.prototype),LeftIndex.prototype.constructor=LeftIndex},{"../Finger.js":11}],16:[function(require,module){var Finger=require("../Finger.js").Finger,LeftMiddle=module.exports.LeftMiddle=function(handInfo){Finger.call(this,handInfo.keyboard);var middleFingerGeometry=new THREE.CubeGeometry(handInfo.middleFingerWidth,handInfo.middleFingerHeight,handInfo.middleFingerLength),middleFingerMaterial=new THREE.MeshLambertMaterial({color:handInfo.middleFingerColor}),middleFingerPosition=new THREE.Vector3(0,.2,.4);this.model=new THREE.Mesh(middleFingerGeometry,middleFingerMaterial),this.model.position.copy(middleFingerPosition),this.originalY=middleFingerPosition.y,this.number=3;var dist=this.distances;this.moveAsNeeded=function(finger,newPosition,newNote){var curX=this.currentPos.x,delta=newPosition-curX,curNote=this.model.currentNote;switch(finger){case 5:this.pinkyRules(delta,curX,curNote,newNote);break;case 4:this.ringRules(delta,curX,curNote,newNote);break;case 2:this.indexRules(delta,curX,curNote,newNote);break;case 1:this.thumbRules(delta,curX,curNote,newNote)}},this.pinkyRules=function(delta,curX,curNote,newNote){delta>dist.get(curNote,curNote-5)&&delta<dist.get(curNote,curNote-3)||this.moveToNote(newNote+3)},this.ringRules=function(delta,curX,curNote,newNote){delta>dist.get(curNote,curNote-4)&&delta<dist.get(curNote,curNote-1)||this.moveToNote(newNote+2)},this.indexRules=function(delta,curX,curNote,newNote){delta>0&&delta<dist.get(curNote,curNote+3)||this.moveToNote(newNote-2)},this.thumbRules=function(delta,curX,curNote,newNote){if(!(delta>0&&delta<dist.get(curNote,curNote+6)))if(delta>dist.get(curNote,curNote-4)&&0>delta){var _this=this;setTimeout(_this.moveToNote(newNote-3),100)}else this.moveToNote(newNote-3)}};LeftMiddle.prototype=Object.create(Finger.prototype),LeftMiddle.prototype.constructor=LeftMiddle},{"../Finger.js":11}],17:[function(require,module){var Finger=require("../Finger.js").Finger,LeftPinky=module.exports.LeftPinky=function(handInfo){Finger.call(this,handInfo.keyboard);var pinkyGeometry=new THREE.CubeGeometry(handInfo.pinkyWidth,handInfo.pinkyHeight,handInfo.pinkyLength),pinkyMaterial=new THREE.MeshLambertMaterial({color:handInfo.pinkyColor}),pinkyPosition=new THREE.Vector3(0,.2,.54);this.model=new THREE.Mesh(pinkyGeometry,pinkyMaterial),this.model.position.copy(pinkyPosition),this.originalY=pinkyPosition.y,this.number=5;var dist=this.distances;this.moveAsNeeded=function(finger,newPosition,newNote){var curX=this.currentPos.x,delta=newPosition-curX,curNote=this.model.currentNote;switch(finger){case 4:this.ringRules(delta,curX,curNote,newNote);break;case 3:this.middleRules(delta,curX,curNote,newNote);break;case 2:this.indexRules(delta,curX,curNote,newNote);break;case 1:this.thumbRules(delta,curX,curNote,newNote)}},this.ringRules=function(delta,curX,curNote,newNote){delta>0&&delta<=dist.get(curNote,curNote+3)||this.moveToNote(newNote-2)},this.middleRules=function(delta,curX,curNote,newNote){delta>0&&delta<=dist.get(curNote,curNote+5)||this.moveToNote(newNote-3)},this.indexRules=function(delta,curX,curNote,newNote){delta>0&&delta<=dist.get(curNote,curNote+7)||this.moveToNote(newNote-5)},this.thumbRules=function(delta,curX,curNote,newNote){if(!(delta>0&&delta<=dist.get(curNote,curNote+12)))if(delta>0&&delta<=dist.get(curNote,curNote+1)){var _this=this;setTimeout(_this.moveToNote(newNote-7),100)}else this.moveToNote(newNote-7)},this.setUpNewTween=function(){var _this=this,update=function(){_this.model.position.x=_this.currentPos.x,_this.model.position.y=_this.currentPos.y+.1,_this.model.position.z=_this.currentPos.z+.1},easing=TWEEN.Easing.Quadratic.Out,tween=new TWEEN.Tween(this.currentPos).to(this.newPos,150).easing(easing).onUpdate(update);tween.start()}};LeftPinky.prototype=Object.create(Finger.prototype),LeftPinky.prototype.constructor=LeftPinky},{"../Finger.js":11}],18:[function(require,module){var Finger=require("../Finger.js").Finger,LeftRing=module.exports.LeftRing=function(handInfo){Finger.call(this,handInfo.keyboard);var ringFingerGeometry=new THREE.CubeGeometry(handInfo.ringFingerWidth,handInfo.ringFingerHeight,handInfo.ringFingerLength),ringFingerMaterial=new THREE.MeshLambertMaterial({color:handInfo.ringFingerColor}),ringFingerPosition=new THREE.Vector3(0,.2,.45);this.model=new THREE.Mesh(ringFingerGeometry,ringFingerMaterial),this.model.position.copy(ringFingerPosition),this.originalY=ringFingerPosition.y,this.number=4;var dist=this.distances;this.moveAsNeeded=function(finger,newPosition,newNote){var curX=this.currentPos.x,delta=newPosition-curX,curNote=this.model.currentNote;switch(finger){case 5:this.pinkyRules(delta,curX,curNote,newNote);break;case 3:this.middleRules(delta,curX,curNote,newNote);break;case 2:this.indexRules(delta,curX,curNote,newNote);break;case 1:this.thumbRules(delta,curX,curNote,newNote)}},this.pinkyRules=function(delta,curX,curNote,newNote){delta>dist.get(curNote,curNote-3)&&delta<dist.get(curNote,curNote-2)||this.moveToNote(newNote+2)},this.middleRules=function(delta,curX,curNote,newNote){delta>0&&delta<dist.get(curNote,curNote+3)||this.moveToNote(newNote-2)},this.indexRules=function(delta,curX,curNote,newNote){delta>0&&delta<dist.get(curNote,curNote+5)||this.moveToNote(newNote-3)},this.thumbRules=function(delta,curX,curNote,newNote){if(!(delta>0&&delta<dist.get(curNote,curNote+8)))if(delta>dist.get(curNote,curNote-2)&&0>delta){var _this=this;setTimeout(_this.moveToNote(newNote-5),100)}else this.moveToNote(newNote-5)}};LeftRing.prototype=Object.create(Finger.prototype),LeftRing.prototype.constructor=LeftRing},{"../Finger.js":11}],19:[function(require,module){var Finger=require("../Finger.js").Finger,LeftThumb=module.exports.LeftThumb=function(handInfo){Finger.call(this,handInfo.keyboard);var thumbGeometry=new THREE.CubeGeometry(handInfo.thumbWidth,handInfo.thumbHeight,handInfo.thumbLength),thumbMaterial=new THREE.MeshLambertMaterial({color:handInfo.thumbColor}),thumbPosition=new THREE.Vector3(0,.3,.6);this.model=new THREE.Mesh(thumbGeometry,thumbMaterial),this.model.position.copy(thumbPosition),this.originalY=thumbPosition.y,this.number=1;var dist=this.distances;this.moveAsNeeded=function(finger,newPosition,newNote){var curX=this.currentPos.x,delta=newPosition-curX,curNote=this.model.currentNote;switch(finger){case 5:this.pinkyRules(delta,curX,curNote,newNote);break;case 4:this.ringRules(delta,curX,curNote,newNote);break;case 3:this.middleRules(delta,curX,curNote,newNote);break;case 2:this.indexRules(delta,curX,curNote,newNote)}},this.pinkyRules=function(delta,curX,curNote,newNote){if(!(delta>=dist.get(curNote,curNote-12)&&delta<=dist.get(curNote,curNote-5)))if(delta>0&&delta<dist.get(curNote,curNote+1)){var _this=this;
setTimeout(_this.moveToNote(newNote+7),100)}else this.moveToNote(newNote+7)},this.ringRules=function(delta,curX,curNote,newNote){if(!(delta>=dist.get(curNote,curNote-9)&&delta<=dist.get(curNote,curNote-4)))if(delta>0&&delta<dist.get(curNote,curNote+2)){var _this=this;setTimeout(_this.moveToNote(newNote+5),100)}else this.moveToNote(newNote+5)},this.middleRules=function(delta,curX,curNote,newNote){if(!(delta>=dist.get(curNote,curNote-7)&&delta<=dist.get(curNote,curNote-2)))if(delta>0&&delta<dist.get(curNote,curNote+4)){var _this=this;setTimeout(_this.moveToNote(newNote+4),100)}else this.moveToNote(newNote+4)},this.indexRules=function(delta,curX,curNote,newNote){if(!(delta>=dist.get(curNote,curNote-4)&&0>delta))if(delta>0&&delta<dist.get(curNote,curNote+2)){var _this=this;setTimeout(_this.moveToNote(newNote+2),100)}else this.moveToNote(newNote+2)},this.setUpNewTween=function(){var _this=this,update=function(){_this.model.position.x=_this.currentPos.x,_this.model.position.y=_this.currentPos.y+.1,_this.model.position.z=_this.currentPos.z+.2},easing=TWEEN.Easing.Quadratic.Out,tween=new TWEEN.Tween(this.currentPos).to(this.newPos,150).easing(easing).onUpdate(update);tween.start()}};LeftThumb.prototype=Object.create(Finger.prototype),LeftThumb.prototype.constructor=LeftThumb},{"../Finger.js":11}],20:[function(require,module){var RightPinky=require("./RightPinky.js").RightPinky,RightRing=require("./RightRing.js").RightRing,RightMiddle=require("./RightMiddle.js").RightMiddle,RightIndex=require("./RightIndex.js").RightIndex,RightThumb=require("./RightThumb.js").RightThumb,HandDesign=require("../HandDesign.js").HandDesign,Dummy=require("../Dummy.js").Dummy;module.exports.RightHand=function(keyboard){var _this=this,handDesign=new HandDesign(keyboard),pinky=new RightPinky(handDesign,"right"),ring=new RightRing(handDesign,"right"),middle=new RightMiddle(handDesign,"right"),index=new RightIndex(handDesign,"right"),thumb=new RightThumb(handDesign,"right"),dummy1=new Dummy,dummy2=new Dummy;this.fingers=[],this.model=new THREE.Object3D,this.fingers.push(void 0),this.model.add(dummy1.model),dummy1.model.currentNote=-1,this.model.add(thumb.model),this.fingers.push(thumb),thumb.model.currentNote=5,this.model.add(index.model),this.fingers.push(index),index.model.currentNote=1,this.model.add(middle.model),this.fingers.push(middle),middle.model.currentNote=1,this.model.add(ring.model),this.fingers.push(ring),ring.model.currentNote=1,this.model.add(pinky.model),this.fingers.push(pinky),pinky.model.currentNote=1,this.model.add(dummy2.model),dummy2.model.currentNote=110,thumb.moveToNote(60),index.moveToNote(62),middle.moveToNote(64),ring.moveToNote(65),pinky.moveToNote(67),this.model.position.y-=.11,this.model.traverse(function(object){object.position.x-=4.45}),this.press=function(finger,noteNum){for(var newPosition=keyboard.keys[noteNum].model.position.x,i=1;5>=i;i++)i===finger?_this.fingers[i].press(noteNum):_this.fingers[i].moveAsNeeded(finger,newPosition,noteNum)},this.release=function(finger){_this.fingers[finger].release()},this.update=function(){for(var fingers=_this.fingers,i=1;i<fingers.length;i++)fingers[i].update()}}},{"../Dummy.js":10,"../HandDesign.js":13,"./RightIndex.js":21,"./RightMiddle.js":22,"./RightPinky.js":23,"./RightRing.js":24,"./RightThumb.js":25}],21:[function(require,module){var Finger=require("../Finger.js").Finger,RightIndex=module.exports.RightIndex=function(handInfo){Finger.call(this,handInfo.keyboard);var indexFingerGeometry=new THREE.CubeGeometry(handInfo.indexFingerWidth,handInfo.indexFingerHeight,handInfo.indexFingerLength),indexFingerMaterial=new THREE.MeshLambertMaterial({color:handInfo.indexFingerColor}),indexFingerPosition=new THREE.Vector3(0,.2,.4);this.model=new THREE.Mesh(indexFingerGeometry,indexFingerMaterial),this.model.position.copy(indexFingerPosition),this.originalY=indexFingerPosition.y,this.number=2;var dist=this.distances;this.moveAsNeeded=function(finger,newPosition,newNote){var curX=this.currentPos.x,delta=newPosition-curX,curNote=this.model.currentNote;switch(finger){case 5:this.pinkyRules(delta,curX,curNote,newNote);break;case 4:this.ringRules(delta,curX,curNote,newNote);break;case 3:this.middleRules(delta,curX,curNote,newNote);break;case 1:this.thumbRules(delta,curX,curNote,newNote)}},this.pinkyRules=function(delta,curX,curNote,newNote){delta>dist.get(curNote,curNote+4)&&delta<dist.get(curNote,curNote+8)||this.moveToNote(newNote-5)},this.ringRules=function(delta,curX,curNote,newNote){delta>dist.get(curNote,curNote+3)&&delta<dist.get(curNote,curNote+7)||this.moveToNote(newNote-3)},this.middleRules=function(delta,curX,curNote,newNote){delta>dist.get(curNote,curNote+2)&&delta<dist.get(curNote,curNote+5)||this.moveToNote(newNote-2)},this.thumbRules=function(delta,curX,curNote,newNote){if(!(delta>dist.get(curNote,curNote-3)&&0>delta))if(delta>0&&delta<dist.get(curNote,curNote+3)){var _this=this;setTimeout(_this.moveToNote(newNote+2),100)}else this.moveToNote(newNote+2)}};RightIndex.prototype=Object.create(Finger.prototype),RightIndex.prototype.constructor=RightIndex},{"../Finger.js":11}],22:[function(require,module){var Finger=require("../Finger.js").Finger,RightMiddle=module.exports.RightMiddle=function(handInfo){Finger.call(this,handInfo.keyboard);var middleFingerGeometry=new THREE.CubeGeometry(handInfo.middleFingerWidth,handInfo.middleFingerHeight,handInfo.middleFingerLength),middleFingerMaterial=new THREE.MeshLambertMaterial({color:handInfo.middleFingerColor}),middleFingerPosition=new THREE.Vector3(0,.2,.4);this.model=new THREE.Mesh(middleFingerGeometry,middleFingerMaterial),this.model.position.copy(middleFingerPosition),this.originalY=middleFingerPosition.y,this.number=3;var dist=this.distances;this.moveAsNeeded=function(finger,newPosition,newNote){var curX=this.currentPos.x,delta=newPosition-curX,curNote=this.model.currentNote;switch(finger){case 5:this.pinkyRules(delta,curX,curNote,newNote);break;case 4:this.ringRules(delta,curX,curNote,newNote);break;case 2:this.indexRules(delta,curX,curNote,newNote);break;case 1:this.thumbRules(delta,curX,curNote,newNote)}},this.pinkyRules=function(delta,curX,curNote,newNote){delta>=dist.get(curNote,curNote+3)&&delta<=dist.get(curNote,curNote+5)||this.moveToNote(newNote-3)},this.ringRules=function(delta,curX,curNote,newNote){delta>=dist.get(curNote,curNote+1)&&delta<=dist.get(curNote,curNote+4)||this.moveToNote(newNote-2)},this.indexRules=function(delta,curX,curNote,newNote){delta>=dist.get(curNote,curNote-3)&&delta<=dist.get(curNote,curNote-1)||this.moveToNote(newNote+2)},this.thumbRules=function(delta,curX,curNote,newNote){if(!(delta>=dist.get(curNote,curNote-6)&&0>delta))if(delta>0&&delta<dist.get(curNote,curNote+4)){var _this=this;setTimeout(_this.moveToNote(newNote+3),100)}else this.moveToNote(newNote+3)}};RightMiddle.prototype=Object.create(Finger.prototype),RightMiddle.prototype.constructor=RightMiddle},{"../Finger.js":11}],23:[function(require,module){var Finger=require("../Finger.js").Finger,RightPinky=module.exports.RightPinky=function(handInfo){Finger.call(this,handInfo.keyboard);var pinkyGeometry=new THREE.CubeGeometry(handInfo.pinkyWidth,handInfo.pinkyHeight,handInfo.pinkyLength),pinkyMaterial=new THREE.MeshLambertMaterial({color:handInfo.pinkyColor}),pinkyPosition=new THREE.Vector3(0,.2,.54);this.model=new THREE.Mesh(pinkyGeometry,pinkyMaterial),this.model.position.copy(pinkyPosition),this.originalY=pinkyPosition.y,this.number=5;var dist=this.distances;this.moveAsNeeded=function(finger,newPosition,newNote){var curX=this.currentPos.x,delta=newPosition-curX,curNote=this.model.currentNote;switch(finger){case 5:this.ringRules(delta,curX,curNote,newNote);break;case 3:this.middleRules(delta,curX,curNote,newNote);break;case 2:this.indexRules(delta,curX,curNote,newNote);break;case 1:this.thumbRules(delta,curX,curNote,newNote)}},this.ringRules=function(delta,curX,curNote,newNote){delta>dist.get(curNote,curNote-3)&&0>delta||this.moveToNote(newNote+2)},this.middleRules=function(delta,curX,curNote,newNote){delta>dist.get(curNote,curNote-5)&&0>delta||this.moveToNote(newNote+3)},this.indexRules=function(delta,curX,curNote,newNote){delta>dist.get(curNote,curNote-7)&&0>delta||this.moveToNote(newNote+5)},this.thumbRules=function(delta,curX,curNote,newNote){if(!(delta>dist.get(curNote,curNote-12)&&0>delta))if(delta>0&&delta<dist.get(curNote,curNote+1)){var _this=this;setTimeout(_this.moveToNote(newNote+7),100)}else this.moveToNote(newNote+7)},this.setUpNewTween=function(){var _this=this,update=function(){_this.model.position.x=_this.currentPos.x,_this.model.position.y=_this.currentPos.y+.1,_this.model.position.z=_this.currentPos.z+.1},easing=TWEEN.Easing.Quadratic.Out,tween=new TWEEN.Tween(this.currentPos).to(this.newPos,150).easing(easing).onUpdate(update);tween.start()}};RightPinky.prototype=Object.create(Finger.prototype),RightPinky.prototype.constructor=RightPinky},{"../Finger.js":11}],24:[function(require,module){var Finger=require("../Finger.js").Finger,RightRing=module.exports.RightRing=function(handInfo){Finger.call(this,handInfo.keyboard);var ringFingerGeometry=new THREE.CubeGeometry(handInfo.ringFingerWidth,handInfo.ringFingerHeight,handInfo.ringFingerLength),ringFingerMaterial=new THREE.MeshLambertMaterial({color:handInfo.ringFingerColor}),ringFingerPosition=new THREE.Vector3(0,.2,.45);this.model=new THREE.Mesh(ringFingerGeometry,ringFingerMaterial),this.model.position.copy(ringFingerPosition),this.originalY=ringFingerPosition.y,this.number=4;var dist=this.distances;this.moveAsNeeded=function(finger,newPosition,newNote){var curX=this.currentPos.x,delta=newPosition-curX,curNote=this.model.currentNote;switch(finger){case 5:this.pinkyRules(delta,curX,curNote,newNote);break;case 3:this.middleRules(delta,curX,curNote,newNote);break;case 2:this.indexRules(delta,curX,curNote,newNote);break;case 1:this.thumbRules(delta,curX,curNote,newNote)}},this.pinkyRules=function(delta,curX,curNote,newNote){delta>dist.get(curNote,curNote+2)&&delta<dist.get(curNote,curNote+3)||this.moveToNote(newNote-2)},this.middleRules=function(delta,curX,curNote,newNote){delta>dist.get(curNote,curNote-3)&&0>delta||this.moveToNote(newNote+2)},this.indexRules=function(delta,curX,curNote,newNote){delta>dist.get(curNote,curNote-5)&&0>delta||this.moveToNote(newNote+3)},this.thumbRules=function(delta,curX,curNote,newNote){if(!(delta>dist.get(curNote,curNote-8)&&0>delta))if(delta>0&&delta<dist.get(curNote,curNote+2)){var _this=this;setTimeout(_this.moveToNote(newNote+5),100)}else this.moveToNote(newNote+5)}};RightRing.prototype=Object.create(Finger.prototype),RightRing.prototype.constructor=RightRing},{"../Finger.js":11}],25:[function(require,module){var Finger=require("../Finger.js").Finger,RightThumb=module.exports.RightThumb=function(handInfo){Finger.call(this,handInfo.keyboard);var thumbGeometry=new THREE.CubeGeometry(handInfo.thumbWidth,handInfo.thumbHeight,handInfo.thumbLength),thumbMaterial=new THREE.MeshLambertMaterial({color:handInfo.thumbColor}),thumbPosition=new THREE.Vector3(0,.3,.6);this.model=new THREE.Mesh(thumbGeometry,thumbMaterial),this.model.position.copy(thumbPosition),this.originalY=thumbPosition.y,this.number=1;var dist=this.distances;this.moveAsNeeded=function(finger,newPosition,newNote){var curX=this.currentPos.x,delta=newPosition-curX,curNote=this.model.currentNote;switch(finger){case 5:this.pinkyRules(delta,curX,curNote,newNote);break;case 4:this.ringRules(delta,curX,curNote,newNote);break;case 3:this.middleRules(delta,curX,curNote,newNote);break;case 2:this.indexRules(delta,curX,curNote,newNote)}},this.pinkyRules=function(delta,curX,curNote,newNote){if(!(delta>=dist.get(curNote,curNote+5)&&delta<dist.get(curNote,curNote+12)))if(delta>=dist.get(curNote,curNote-2)&&0>delta){var _this=this;setTimeout(_this.moveToNote(newNote-7),100)}else this.moveToNote(newNote-7)},this.ringRules=function(delta,curX,curNote,newNote){if(!(delta>=dist.get(curNote,curNote+4)&&delta<=dist.get(curNote,curNote+9)))if(delta>dist.get(curNote,curNote-2)&&0>delta){var _this=this;setTimeout(_this.moveToNote(newNote-5),100)}else this.moveToNote(newNote-5)},this.middleRules=function(delta,curX,curNote,newNote){if(!(delta>=dist.get(curNote,curNote+2)&&delta<=dist.get(curNote,curNote+7)))if(delta>dist.get(curNote,curNote-3)&&0>delta){var _this=this;setTimeout(_this.moveToNote(newNote-4),100)}else this.moveToNote(newNote-4)},this.indexRules=function(delta,curX,curNote,newNote){if(!(delta>0&&delta<=dist.get(curNote,curNote+4)))if(delta>dist.get(curNote,curNote-2)&&0>delta){var _this=this;setTimeout(_this.moveToNote(newNote-2),100)}else this.moveToNote(newNote-2)},this.setUpNewTween=function(){var _this=this,update=function(){_this.model.position.x=_this.currentPos.x,_this.model.position.y=_this.currentPos.y+.1,_this.model.position.z=_this.currentPos.z+.2},easing=TWEEN.Easing.Quadratic.Out,tween=new TWEEN.Tween(this.currentPos).to(this.newPos,150).easing(easing).onUpdate(update);tween.start()}};RightThumb.prototype=Object.create(Finger.prototype),RightThumb.prototype.constructor=RightThumb},{"../Finger.js":11}],26:[function(require,module){var PianoKey=require("./PianoKey.js").PianoKey;module.exports.Keyboard=function(keyboardDesign){this.model=new THREE.Object3D,this.keys=[];for(var _this=this,note=0;note<keyboardDesign.keyInfo.length;note++){var key=new PianoKey(keyboardDesign,note);_this.keys.push(key),note>20&&109>note&&this.model.add(key.model)}this.model.position.y-=keyboardDesign.whiteKeyHeight/2,this.model.traverse(function(object){object.position.x-=4.45}),this.press=function(note){_this.keys[note].press()},this.release=function(note){_this.keys[note].release()},this.update=function(){for(var _this=this,allKeys=_this.keys,i=0;i<allKeys.length;i++)allKeys[i].update()}}},{"./PianoKey.js":28}],27:[function(require,module){module.exports.KeyboardDesign=function(){this.KeyType={WhiteC:0,WhiteD:1,WhiteE:2,WhiteF:3,WhiteG:4,WhiteA:5,WhiteB:6,Black:7},this.whiteKeyStep=.236,this.whiteKeyWidth=.226,this.whiteKeyHeight=.22,this.whiteKeyLength=1.5,this.blackKeyWidth=.1,this.blackKeyHeight=.24,this.blackKeyLength=1,this.blackKeyShiftCDE=.0216,this.blackKeyShiftFGAB=.034,this.blackKeyPosY=.1,this.blackKeyPosZ=-.24,this.noteDropPosZ4WhiteKey=.25,this.noteDropPosZ4BlackKey=.75,this.whiteKeyColor=15794175,this.blackKeyColor=0,this.keyDip=.08,this.keyUpSpeed=.03,this.keyInfo=[];var _this=this,createBoardInfo=function(){makeNoteObjects(),initKeyType(),initKeyPos()},makeNoteObjects=function(){for(var i=0;120>i;i++){var noteObj={};_this.keyInfo.push(noteObj)}},initKeyType=function(){for(var KeyType=_this.KeyType,keyInfo=_this.keyInfo,i=0;10>i;i++){var noteNo=12*i;keyInfo[noteNo+0].keyType=KeyType.WhiteC,keyInfo[noteNo+1].keyType=KeyType.Black,keyInfo[noteNo+2].keyType=KeyType.WhiteD,keyInfo[noteNo+3].keyType=KeyType.Black,keyInfo[noteNo+4].keyType=KeyType.WhiteE,keyInfo[noteNo+5].keyType=KeyType.WhiteF,keyInfo[noteNo+6].keyType=KeyType.Black,keyInfo[noteNo+7].keyType=KeyType.WhiteG,keyInfo[noteNo+8].keyType=KeyType.Black,keyInfo[noteNo+9].keyType=KeyType.WhiteA,keyInfo[noteNo+10].keyType=KeyType.Black,keyInfo[noteNo+11].keyType=KeyType.WhiteD}},initKeyPos=function(){var keyInfo=_this.keyInfo,KeyType=_this.KeyType,prevKeyType=KeyType.WhiteB,noteNo=0,posX=0,Black=KeyType.Black;for(keyInfo[noteNo].keyCenterPosX=posX,prevKeyType=keyInfo[noteNo].keyType,noteNo=1;noteNo<keyInfo.length;noteNo++)posX+=prevKeyType===Black?_this.whiteKeyStep/2:keyInfo[noteNo].keyType===Black?_this.whiteKeyStep/2:_this.whiteKeyStep,keyInfo[noteNo].keyCenterPosX=posX,prevKeyType=keyInfo[noteNo].keyType};createBoardInfo()}},{}],28:[function(require,module){var PianoKey=module.exports.PianoKey=function(boardInfo,note){var Black=boardInfo.KeyType.Black,keyType=boardInfo.keyInfo[note].keyType,keyCenterPosX=boardInfo.keyInfo[note].keyCenterPosX;boardInfo.keyUpSpeed;var geometry,material,position;keyType===Black?(geometry=new THREE.CubeGeometry(boardInfo.blackKeyWidth,boardInfo.blackKeyHeight,boardInfo.blackKeyLength),material=new THREE.MeshPhongMaterial({color:boardInfo.blackKeyColor}),position=new THREE.Vector3(keyCenterPosX,boardInfo.blackKeyPosY,boardInfo.blackKeyPosZ),this.originalColor={r:0,g:0,b:0}):(geometry=new THREE.CubeGeometry(boardInfo.whiteKeyWidth,boardInfo.whiteKeyHeight,boardInfo.whiteKeyLength),material=new THREE.MeshPhongMaterial({color:boardInfo.whiteKeyColor,emissive:1118481}),position=new THREE.Vector3(keyCenterPosX,boardInfo.whiteKeyPosY,boardInfo.whiteKeyPosZ),this.originalColor={r:.941,g:1,b:1}),this.model=new THREE.Mesh(geometry,material),this.model.position.copy(position),this.keyUpSpeed=boardInfo.keyUpSpeed,this.originalY=position.y,this.pressedY=this.originalY-boardInfo.keyDip,this.newColor={r:0,g:0,b:0},this.currentColor={r:this.originalColor.r,g:this.originalColor.g,b:this.originalColor.b}};PianoKey.prototype.press=function(){this.model.position.y=this.pressedY,this.newColor={r:.145,g:.749,b:.854},this.setUpNewTween(),this.isPressed=!0},PianoKey.prototype.release=function(){this.isPressed=!1,this.newColor=this.originalColor,this.setUpNewTween()},PianoKey.prototype.update=function(){if(this.model.position.y<this.originalY&&this.isPressed===!1){var offset=this.originalY-this.model.position.y;this.model.position.y+=Math.min(offset,this.keyUpSpeed)}},PianoKey.prototype.setUpNewTween=function(){var _this=this,update=function(){_this.model.material.color.setRGB(_this.currentColor.r,_this.currentColor.g,_this.currentColor.b)},easing=TWEEN.Easing.Quadratic.Out,tween=new TWEEN.Tween(this.currentColor).to(this.newColor,150).easing(easing).onUpdate(update);tween.start()}},{}],29:[function(require,module){module.exports.Scene=function(container){var $container=$(container),width=$container.width(),height=$container.height(),_this=this,scene=new THREE.Scene,view_angle=85,aspect=width/height,near=.001,far=1e3,camera=new THREE.PerspectiveCamera(view_angle,aspect,near,far);camera.position.set(0,3,1.2),camera.lookAt(new THREE.Vector3(10,50,5));var controls=new THREE.TrackballControls(camera);controls.rotateSpeed=1,controls.zoomSpeed=1.2,controls.panSpeed=.8,controls.noZoom=!1,controls.noPan=!1,controls.staticMoving=!0,controls.dynamicDampingFactor=.3,controls.keys=[65,83,68];var renderer=Detector.webgl?new THREE.WebGLRenderer({antialias:!0}):new THREE.CanvasRenderer;renderer.setSize(width,height),renderer.setClearColor(0,1),renderer.autoClear=!1,$container.append(renderer.domElement);var ambientLight=new THREE.AmbientLight(2236962),mainLight=new THREE.DirectionalLight(16777215,.8);mainLight.position.set(1,2,4).normalize();var auxLight=new THREE.DirectionalLight(16777215,.3);auxLight.position.set(-4,-1,-2).normalize,scene.add(ambientLight),scene.add(mainLight),scene.add(auxLight),scene.add(camera),this.camera=camera,this.renderer=renderer,this.scene=scene,this.add=function(object){scene.add(object)},this.animate=function(callback){requestAnimationFrame(function(){_this.animate(callback)}),"function"==typeof callback&&callback(),controls.update(),_this.renderer.render(_this.scene,_this.camera)}}},{}]},{},[8]);