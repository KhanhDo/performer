if("undefined"==typeof MIDI)var MIDI={};if(function(){"use strict";var a={},b=function(b){var c=new Audio,d=b.split(";")[0];c.id="audio",c.setAttribute("preload","auto"),c.setAttribute("audiobuffer",!0),c.addEventListener("canplaythrough",function(){a[d]=!0},!1),c.src="data:"+b,document.body.appendChild(c)};MIDI.audioDetect=function(c){if("undefined"==typeof Audio)return c({});var d=new Audio;if("undefined"==typeof d.canPlayType)return c(a);var e=d.canPlayType('audio/ogg; codecs="vorbis"');e="probably"===e||"maybe"===e;var f=d.canPlayType("audio/mpeg");if(f="probably"===f||"maybe"===f,!e&&!f)return c(a),void 0;e&&b("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA="),f&&b("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");var g=(new Date).getTime(),h=window.setInterval(function(){for(var b in a);var d=(new Date).getTime(),e=d-g>5e3;(b||e)&&(window.clearInterval(h),c(a))},1)}}(),"undefined"==typeof MIDI)var MIDI={};if("undefined"==typeof MIDI.Soundfont&&(MIDI.Soundfont={}),function(){"use strict";var a=!1,b=!1;MIDI.loadPlugin=function(a){"function"==typeof a&&(a={callback:a});var e=a.instruments||a.instrument||"acoustic_grand_piano";"object"!=typeof e&&(e=[e]);for(var f=0;f<e.length;f++){var g=e[f];"number"==typeof g&&(e[f]=MIDI.GeneralMIDI.byId[g])}MIDI.soundfontUrl=a.soundfontUrl||MIDI.soundfontUrl||"./soundfont/",MIDI.audioDetect(function(f){var g="";if(g=d[a.api]?a.api:d[window.location.hash.substr(1)]?window.location.hash.substr(1):b&&navigator.requestMIDIAccess?"webmidi":window.webkitAudioContext?"webaudio":window.Audio?"audiotag":"flash",c[g]){var h=f["audio/ogg"]?"ogg":"mp3";c[g](h,e,a)}})};var c={};c.webmidi=function(a,b,c){MIDI.loader&&MIDI.loader.message("Web MIDI API..."),MIDI.WebMIDI.connect(c)},c.flash=function(a,b,c){MIDI.loader&&MIDI.loader.message("Flash API..."),DOMLoader.script.add({src:c.soundManagerUrl||"./inc/SoundManager2/script/soundmanager2.js",verify:"SoundManager",callback:function(){MIDI.Flash.connect(b,c)}})},c.audiotag=function(b,c,d){MIDI.loader&&MIDI.loader.message("HTML5 Audio API...");var g=f({items:c,getNext:function(c){a?DOMLoader.sendRequest({url:MIDI.soundfontUrl+c+"-"+b+".js",onprogress:e,onload:function(a){MIDI.Soundfont[c]=JSON.parse(a.responseText),MIDI.loader&&MIDI.loader.update(null,"Downloading",100),g.getNext()}}):DOMLoader.script.add({src:MIDI.soundfontUrl+c+"-"+b+".js",verify:"MIDI.Soundfont."+c,callback:function(){MIDI.loader&&MIDI.loader.update(null,"Downloading...",100),g.getNext()}})},onComplete:function(){MIDI.AudioTag.connect(d)}})},c.webaudio=function(b,c,d){MIDI.loader&&MIDI.loader.message("Web Audio API...");var g=f({items:c,getNext:function(c){a?DOMLoader.sendRequest({url:MIDI.soundfontUrl+c+"-"+b+".js",onprogress:e,onload:function(a){MIDI.Soundfont[c]=JSON.parse(a.responseText),MIDI.loader&&MIDI.loader.update(null,"Downloading...",100),g.getNext()}}):DOMLoader.script.add({src:MIDI.soundfontUrl+c+"-"+b+".js",verify:"MIDI.Soundfont."+c,callback:function(){MIDI.loader&&MIDI.loader.update(null,"Downloading...",100),g.getNext()}})},onComplete:function(){MIDI.WebAudio.connect(d)}})};var d={webmidi:!0,webaudio:!0,audiotag:!0,flash:!0},e=function(a){this.totalSize||(this.totalSize=this.getResponseHeader("Content-Length-Raw")?parseInt(this.getResponseHeader("Content-Length-Raw")):a.total);var b=this.totalSize?Math.round(100*(a.loaded/this.totalSize)):"";MIDI.loader&&MIDI.loader.update(null,"Downloading...",b)},f=function(a){var b={};b.queue=[];for(var c in a.items)b.queue.push(a.items[c]);return b.getNext=function(){return b.queue.length?(a.getNext(b.queue.shift()),void 0):a.onComplete()},setTimeout(b.getNext,1),b}}(),"undefined"==typeof MIDI)var MIDI={};if(function(){"use strict";var a=function(a){MIDI.api=a.api,MIDI.setVolume=a.setVolume,MIDI.programChange=a.programChange,MIDI.noteOn=a.noteOn,MIDI.noteOff=a.noteOff,MIDI.chordOn=a.chordOn,MIDI.chordOff=a.chordOff,MIDI.stopAllNotes=a.stopAllNotes,MIDI.getInput=a.getInput,MIDI.getOutputs=a.getOutputs};!function(){var b=null,c=null,d=MIDI.WebMIDI={api:"webmidi"};d.setVolume=function(a,b){c.send([176+a,7,b])},d.programChange=function(a,b){c.send([192+a,b])},d.noteOn=function(a,b,d,e){c.send([144+a,b,d],1e3*e)},d.noteOff=function(a,b,d){c.send([128+a,b,0],1e3*d)},d.chordOn=function(a,b,d,e){for(var f=0;f<b.length;f++){var g=b[f];c.send([144+a,g,d],1e3*e)}},d.chordOff=function(a,b,d){for(var e=0;e<b.length;e++){var f=b[e];c.send([128+a,f,0],1e3*d)}},d.stopAllNotes=function(){for(var a=0;16>a;a++)c.send([176+a,123,0])},d.getInput=function(){return b.getInputs()},d.getOutputs=function(){return b.getOutputs()},d.connect=function(e){a(d),navigator.requestMIDIAccess(function(a){b=a,c=b.getOutput(0),e.callback&&e.callback()},function(){e.api=window.webkitAudioContext?"webaudio":window.Audio?"audiotag":"flash",MIDI.loadPlugin(e)})}}(),(window.AudioContext||window.webkitAudioContext)&&function(){var b,c=window.AudioContext||window.webkitAudioContext,d=MIDI.WebAudio={api:"webaudio"},e={},f=127,g={},h=function(a,c,d,e,f){var h=MIDI.GeneralMIDI.byName[a],i=h.number,j=c[d];if(!MIDI.Soundfont[a][j])return f(a);var k=MIDI.Soundfont[a][j].split(",")[1],l=Base64Binary.decodeArrayBuffer(k);b.decodeAudioData(l,function(b){for(var k=j;k.length<3;)k+="&nbsp;";if("undefined"!=typeof MIDI.loader&&MIDI.loader.update(null,h.instrument+"<br>Processing: "+(100*(d/87)>>0)+"%<br>"+k),b.id=j,e[d]=b,e.length===c.length){for(;e.length;)if(b=e.pop()){var l=MIDI.keyToNote[b.id];g[i+""+l]=b}f(a)}})};d.setVolume=function(a,b){f=b},d.programChange=function(a,b){MIDI.channels[a].instrument=b},d.noteOn=function(a,c,d,h){if(MIDI.channels[a]){var i=MIDI.channels[a].instrument;if(g[i+""+c]){h<b.currentTime&&(h+=b.currentTime);var j=b.createBufferSource();e[a+""+c]=j,j.buffer=g[i+""+c],j.connect(b.destination);var k=b.createGainNode(),l=2*d/127*(f/127)-1;return k.connect(b.destination),k.gain.value=Math.max(-1,l),j.connect(k),j.noteOn(h||0),j}}},d.noteOff=function(a,c,d){d=d||0,d<b.currentTime&&(d+=b.currentTime);var f=e[a+""+c];return f?(f.gain.linearRampToValueAtTime(1,d),f.gain.linearRampToValueAtTime(0,d+.2),f.noteOff(d+.3),f):void 0},d.chordOn=function(a,b,c,e){for(var f,g={},h=0,i=b.length;i>h;h++)g[f=b[h]]=d.noteOn(a,f,c,e);return g},d.chordOff=function(a,b,c){for(var e,f={},g=0,h=b.length;h>g;g++)f[e=b[g]]=d.noteOff(a,e,c);return f},d.connect=function(e){a(d),MIDI.Player.ctx=b=new c;var f=[],g=MIDI.keyToNote;for(var i in g)f.push(i);var j=[],k={},l=function(a){delete k[a];for(var b in k)break;b||e.callback()};for(var m in MIDI.Soundfont){k[m]=!0;for(var n=0;n<f.length;n++)h(m,f,n,j,l)}}}(),window.Audio&&function(){for(var b=MIDI.AudioTag={api:"audiotag"},c={},d=127,e=-1,f=[],g=[],h={},i=0;12>i;i++)f[i]=new Audio;var j=function(a,b){if(MIDI.channels[a]){var c=MIDI.channels[a].instrument,i=MIDI.GeneralMIDI.byId[c].id,b=h[b];if(b){var j=i+""+b.id,k=(e+1)%f.length,l=f[k];g[k]=j,l.src=MIDI.Soundfont[i][b.id],l.volume=d/127,l.play(),e=k}}},k=function(a,b){if(MIDI.channels[a]){var c=MIDI.channels[a].instrument,d=MIDI.GeneralMIDI.byId[c].id,b=h[b];if(b)for(var i=d+""+b.id,j=0;j<f.length;j++){var k=(j+e+1)%f.length,l=g[k];if(l&&l==i)return f[k].pause(),g[k]=null,void 0}}};b.programChange=function(a,b){MIDI.channels[a].instrument=b},b.setVolume=function(a,b){d=b},b.noteOn=function(a,b,d,e){var f=c[b];if(h[f])return e?window.setTimeout(function(){j(a,f)},1e3*e):(j(a,f),void 0)},b.noteOff=function(a,b,d){var e=c[b];if(h[e])return d?setTimeout(function(){k(a,e)},1e3*d):(k(a,e),void 0)},b.chordOn=function(a,b,d,e){for(var f=0;f<b.length;f++){var g=b[f],i=c[g];if(h[i]){if(e)return window.setTimeout(function(){j(a,i)},1e3*e);j(a,i)}}},b.chordOff=function(a,b,d){for(var e=0;e<b.length;e++){var f=b[e],g=c[f];if(h[g]){if(d)return window.setTimeout(function(){k(a,g)},1e3*d);k(a,g)}}},b.stopAllNotes=function(){for(var a=0,b=f.length;b>a;a++)f[a].pause()},b.connect=function(d){for(var e in MIDI.keyToNote)c[MIDI.keyToNote[e]]=e,h[e]={id:e};a(b),d.callback&&d.callback()}}(),function(){var b=MIDI.Flash={api:"flash"},c={},d={};b.programChange=function(a,b){MIDI.channels[a].instrument=b},b.setVolume=function(){},b.noteOn=function(a,b,e,f){if(MIDI.channels[a]){var g=MIDI.channels[a].instrument,h=MIDI.GeneralMIDI.byId[g].number;if(b=h+""+c[b],d[b])return f?window.setTimeout(function(){d[b].play({volume:2*e})},1e3*f):(d[b].play({volume:2*e}),void 0)}},b.noteOff=function(){},b.chordOn=function(a,b,e){if(MIDI.channels[a]){var f=MIDI.channels[a].instrument,g=MIDI.GeneralMIDI.byId[f].number;for(var h in b){var i=b[h],j=g+""+c[i];d[j]&&d[j].play({volume:2*e})}}},b.chordOff=function(){},b.stopAllNotes=function(){},b.connect=function(e,f){soundManager.flashVersion=9,soundManager.useHTML5Audio=!0,soundManager.url=f.soundManagerSwfUrl||"../inc/SoundManager2/swf/",soundManager.useHighPerformance=!0,soundManager.wmode="transparent",soundManager.flashPollingInterval=1,soundManager.debugMode=!1,soundManager.onload=function(){for(var g=function(a,b,c){var e=MIDI.GeneralMIDI.byName[a],f=e.number;d[f+""+b]=soundManager.createSound({id:b,url:MIDI.soundfontUrl+a+"-mp3/"+b+".mp3",multiShot:!0,autoLoad:!0,onload:c})},h=[],i=88,j=e.length*i,k=0;k<e.length;k++)for(var l=e[k],m=function(){h.push(this.sID),"undefined"!=typeof MIDI.loader&&MIDI.loader.update(null,"Processing: "+this.sID)},n=0;i>n;n++){var o=c[n+21];g(l,o,m)}a(b);var p=window.setInterval(function(){h.length<j||(window.clearInterval(p),f.callback&&f.callback())},25)},soundManager.onerror=function(){};for(var g in MIDI.keyToNote)c[MIDI.keyToNote[g]]=g}}(),MIDI.GeneralMIDI=function(a){var b=function(a){return a.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()},c={byName:{},byId:{},byCategory:{}};for(var d in a)for(var e=a[d],f=0,g=e.length;g>f;f++){var h=e[f];if(h){var i=parseInt(h.substr(0,h.indexOf(" ")),10);h=h.replace(i+" ",""),c.byId[--i]=c.byName[b(h)]=c.byCategory[b(d)]={id:b(h),instrument:h,number:i,category:d}}}return c}({Piano:["1 Acoustic Grand Piano","2 Bright Acoustic Piano","3 Electric Grand Piano","4 Honky-tonk Piano","5 Electric Piano 1","6 Electric Piano 2","7 Harpsichord","8 Clavinet"],"Chromatic Percussion":["9 Celesta","10 Glockenspiel","11 Music Box","12 Vibraphone","13 Marimba","14 Xylophone","15 Tubular Bells","16 Dulcimer"],Organ:["17 Drawbar Organ","18 Percussive Organ","19 Rock Organ","20 Church Organ","21 Reed Organ","22 Accordion","23 Harmonica","24 Tango Accordion"],Guitar:["25 Acoustic Guitar (nylon)","26 Acoustic Guitar (steel)","27 Electric Guitar (jazz)","28 Electric Guitar (clean)","29 Electric Guitar (muted)","30 Overdriven Guitar","31 Distortion Guitar","32 Guitar Harmonics"],Bass:["33 Acoustic Bass","34 Electric Bass (finger)","35 Electric Bass (pick)","36 Fretless Bass","37 Slap Bass 1","38 Slap Bass 2","39 Synth Bass 1","40 Synth Bass 2"],Strings:["41 Violin","42 Viola","43 Cello","44 Contrabass","45 Tremolo Strings","46 Pizzicato Strings","47 Orchestral Harp","48 Timpani"],Ensemble:["49 String Ensemble 1","50 String Ensemble 2","51 Synth Strings 1","52 Synth Strings 2","53 Choir Aahs","54 Voice Oohs","55 Synth Choir","56 Orchestra Hit"],Brass:["57 Trumpet","58 Trombone","59 Tuba","60 Muted Trumpet","61 French Horn","62 Brass Section","63 Synth Brass 1","64 Synth Brass 2"],Reed:["65 Soprano Sax","66 Alto Sax","67 Tenor Sax","68 Baritone Sax","69 Oboe","70 English Horn","71 Bassoon","72 Clarinet"],Pipe:["73 Piccolo","74 Flute","75 Recorder","76 Pan Flute","77 Blown Bottle","78 Shakuhachi","79 Whistle","80 Ocarina"],"Synth Lead":["81 Lead 1 (square)","82 Lead 2 (sawtooth)","83 Lead 3 (calliope)","84 Lead 4 (chiff)","85 Lead 5 (charang)","86 Lead 6 (voice)","87 Lead 7 (fifths)","88 Lead 8 (bass + lead)"],"Synth Pad":["89 Pad 1 (new age)","90 Pad 2 (warm)","91 Pad 3 (polysynth)","92 Pad 4 (choir)","93 Pad 5 (bowed)","94 Pad 6 (metallic)","95 Pad 7 (halo)","96 Pad 8 (sweep)"],"Synth Effects":["97 FX 1 (rain)","98 FX 2 (soundtrack)","99 FX 3 (crystal)","100 FX 4 (atmosphere)","101 FX 5 (brightness)","102 FX 6 (goblins)","103 FX 7 (echoes)","104 FX 8 (sci-fi)"],Ethnic:["105 Sitar","106 Banjo","107 Shamisen","108 Koto","109 Kalimba","110 Bagpipe","111 Fiddle","112 Shanai"],Percussive:["113 Tinkle Bell","114 Agogo","115 Steel Drums","116 Woodblock","117 Taiko Drum","118 Melodic Tom","119 Synth Drum"],"Sound effects":["120 Reverse Cymbal","121 Guitar Fret Noise","122 Breath Noise","123 Seashore","124 Bird Tweet","125 Telephone Ring","126 Helicopter","127 Applause","128 Gunshot"]}),MIDI.channels=function(){for(var a={},b=0;16>b;b++)a[b]={instrument:0,mute:!1,mono:!1,omni:!1,solo:!1};return a}(),MIDI.pianoKeyOffset=21,MIDI.keyToNote={},MIDI.noteToKey={},function(){for(var a=21,b=108,c=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],d=a;b>=d;d++){var e=(d-12)/12>>0,f=c[d%12]+e;MIDI.keyToNote[f]=d,MIDI.noteToKey[d]=f}}()}(),"undefined"==typeof MIDI)var MIDI={};if("undefined"==typeof MIDI.Player&&(MIDI.Player={}),function(){"use strict";var a=MIDI.Player;a.callback=void 0,a.currentTime=0,a.endTime=0,a.restart=0,a.playing=!1,a.timeWarp=1,a.start=a.resume=function(){a.currentTime<-1&&(a.currentTime=-1),j(a.currentTime)},a.pause=function(){var b=a.restart;k(),a.restart=b},a.stop=function(){k(),a.restart=0,a.currentTime=0},a.addListener=function(a){f=a},a.removeListener=function(){f=void 0},a.clearAnimation=function(){a.interval&&window.clearInterval(a.interval)},a.setAnimation=function(b){var c="function"==typeof b?b:b.callback,d=b.interval||30,f=0,g=0,h=0;a.clearAnimation(),a.interval=window.setInterval(function(){if(0!==a.endTime){a.playing?(f=h===a.currentTime?g-(new Date).getTime():0,f=0===a.currentTime?0:a.currentTime-f,h!==a.currentTime&&(g=(new Date).getTime(),h=a.currentTime)):f=a.currentTime;var b=a.endTime,d=f/1e3,i=d/60,j=d-60*i,k=60*i+j,l=b/1e3;-1>l-k||c({now:k,end:l,events:e})}},d)},a.loadMidiFile=function(){console.log("load Midi File called"),a.replayer=new Replayer(MidiFile(a.currentData),a.timeWarp),a.data=a.replayer.getData(),app.fingeringAlgorithm(),a.endTime=i()},a.loadFile=function(b,c){if(console.log("loadFile called"),a.stop(),-1!==b.indexOf("base64,")){var d=window.atob(b.split(",")[1]);return a.currentData=d,a.loadMidiFile(),c&&c(d),void 0}var e=new XMLHttpRequest;e.open("GET","/files/"+b),e.overrideMimeType("text/plain; charset=x-user-defined"),e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){for(var b=this.responseText||"",d=[],e=b.length,f=String.fromCharCode,g=0;e>g;g++)d[g]=f(255&b.charCodeAt(g));var h=d.join("");a.currentData=h,a.loadMidiFile(),c&&c(h)}},e.send()};var b,c=[],d=0,e={},f=void 0,g=function(c,d,g,h,i,k,l){var m=window.setTimeout(function(){var h={channel:c,note:d,now:g,end:a.endTime,message:i,velocity:k,finger:l};128===i?delete e[d]:e[d]=h,f&&f(h),a.currentTime=g,a.currentTime===b&&b<a.endTime&&j(b,!0)},g-h);return m},h=function(){return"WebAudioAPI"===MIDI.lang?MIDI.Player.ctx:(a.ctx||(a.ctx={currentTime:0}),a.ctx)},i=function(){for(var b=a.data,c=b.length,d=.5,e=0;c>e;e++)d+=b[e][1];return d},j=function(e,f){if(a.replayer){f||("undefined"==typeof e&&(e=a.restart),a.playing&&k(),a.playing=!0,a.endTime=i());var j,l=0,m=0,n=a.data,o=h(),p=n.length;b=.5,d=o.currentTime;for(var q=0;p>q&&100>m;q++)if(b+=n[q][1],e>b)l=b;else{e=b-l;var r=n[q][0].event;if("channel"===r.type){var s=r.channel;switch(r.subtype){case"noteOn":if(MIDI.channels[s].mute)break;j=r.noteNumber-(a.MIDIOffset||0),c.push({event:r,source:MIDI.noteOn(s,r.noteNumber,r.velocity,(e+60)/1e3+o.currentTime),interval:g(s,j,b,l,144,r.velocity,r.finger)}),m++;break;case"noteOff":if(MIDI.channels[s].mute)break;j=r.noteNumber-(a.MIDIOffset||0),c.push({event:r,source:MIDI.noteOff(s,r.noteNumber,e/1e3+o.currentTime),interval:g(s,j,b,l,128,0,r.finger)})}}}}},k=function(){var b=h();for(a.playing=!1,a.restart+=1e3*(b.currentTime-d);c.length;){var g=c.pop();if(window.clearInterval(g.interval),g.source)if("number"==typeof g.source)window.clearTimeout(g.source);else{var i=g.source;i.disconnect(0),i.noteOff(0)}}for(var j in e){var g=e[j];144===e[j].message&&f&&f({channel:g.channel,note:g.note,now:g.now,end:g.end,message:128,velocity:g.velocity})}e={}}}(),"undefined"==typeof DOMLoader)var DOMLoader={};if("undefined"==typeof XMLHttpRequest){var XMLHttpRequest;!function(){for(var a=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=0;b<a.length;b++){try{a[b]()}catch(c){continue}break}XMLHttpRequest=a[b]}()}if("undefined"==typeof(new XMLHttpRequest).responseText){var IEBinaryToArray_ByteStr_Script="<!-- IEBinaryToArray_ByteStr -->\r\n<script type='text/vbscript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last = \"\"\r\n   End If\r\nEnd Function\r\n</script>\r\n";document.write(IEBinaryToArray_ByteStr_Script),DOMLoader.sendRequest=function(a){function b(a){for(var b={},c=0;256>c;c++)for(var d=0;256>d;d++)b[String.fromCharCode(c+256*d)]=String.fromCharCode(c)+String.fromCharCode(d);var e=IEBinaryToArray_ByteStr(a),f=IEBinaryToArray_ByteStr_Last(a);return e.replace(/[\s\S]/g,function(a){return b[a]})+f}var c=XMLHttpRequest();return c.open("GET",a.url,!0),a.responseType&&(c.responseType=a.responseType),a.onerror&&(c.onerror=a.onerror),a.onprogress&&(c.onprogress=a.onprogress),c.onreadystatechange=function(){4===c.readyState&&(200===c.status?c.responseText=b(c.responseBody):c=!1,a.onload&&a.onload(c))},c.setRequestHeader("Accept-Charset","x-user-defined"),c.send(null),c}}else DOMLoader.sendRequest=function(a){var b=new XMLHttpRequest;return b.open(a.data?"POST":"GET",a.url,!0),b.overrideMimeType&&b.overrideMimeType("text/plain; charset=x-user-defined"),a.data&&b.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.responseType&&(b.responseType=a.responseType),a.onerror&&(b.onerror=a.onerror),a.onprogress&&(b.onprogress=a.onprogress),b.onreadystatechange=function(c){if(4===b.readyState){if(200!==b.status&&304!=b.status)return a.onerror&&a.onerror(c,!1),void 0;a.onload&&a.onload(b)}},b.send(a.data),b};if("undefined"==typeof DOMLoader)var DOMLoader={};!function(){"use strict";DOMLoader.script=function(){return this.loaded={},this.loading={},this},DOMLoader.script.prototype.add=function(a){var b=this;"string"==typeof a&&(a={src:a});var c=a.srcs;"undefined"==typeof c&&(c=[{src:a.src,verify:a.verify}]);var d=document.getElementsByTagName("head")[0],e=function(a,c){b.loaded[a.src]||c&&"undefined"==typeof window[c]||(b.loaded[a.src]=!0,b.loading[a.src]&&b.loading[a.src](),delete b.loading[a.src],a.callback&&a.callback(),"undefined"!=typeof j&&j())},f=[],g=function(c){if("string"==typeof c&&(c={src:c,verify:a.verify}),/([\w\d.])$/.test(c.verify))if(c.test=c.verify,"object"==typeof c.test)for(var g in c.test)f.push(c.test[g]);else f.push(c.test);if(!b.loaded[c.src]){var h=document.createElement("script");h.onreadystatechange=function(){("loaded"===this.readyState||"complete"===this.readyState)&&e(c)},h.onload=function(){e(c)},h.onerror=function(){},h.setAttribute("type","text/javascript"),h.setAttribute("src",c.src),d.appendChild(h),b.loading[c.src]=function(){}}},h=function(b){if(b)e(b,b.test);else for(var d=0;d<c.length;d++)e(c[d],c[d].test);for(var g=!0,d=0;d<f.length;d++){var i=f[d];if(i&&-1!==i.indexOf(".")){i=i.split(".");var j=window[i[0]];if("undefined"==typeof j)continue;2===i.length?"undefined"==typeof j[i[1]]&&(g=!1):3===i.length&&"undefined"==typeof j[i[1]][i[2]]&&(g=!1)}else"undefined"==typeof window[i]&&(g=!1)}!a.strictOrder&&g?a.callback&&a.callback():setTimeout(function(){h(b)},10)};if(a.strictOrder){var i=-1,j=function(){if(i++,c[i]){var d=c[i],e=d.src;b.loading[e]?b.loading[e]=function(){d.callback&&d.callback(),j()}:b.loaded[e]?j():(g(d),h(d))}else a.callback&&a.callback()};j()}else{for(var i=0;i<c.length;i++)g(c[i]);h()}},DOMLoader.script=new DOMLoader.script}();